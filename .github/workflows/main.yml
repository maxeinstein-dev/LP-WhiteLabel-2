name: Build and Deploy to FTP

on:
    push:
        branches:
            - main
    workflow_dispatch:

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest

        steps:
            # 1. Checkout do cÃ³digo
            - name: ğŸ“¥ Checkout Repository
              uses: actions/checkout@v4

            # 2. Setup Node.js
            - name: ğŸŸ¢ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"

            # 3. Instalar dependÃªncias (se houver)
            - name: ğŸ“¦ Install Dependencies
              run: |
                  if [ -f package.json ]; then
                    npm ci
                  else
                    echo "No package.json found, skipping npm install"
                  fi

            # 4. Executar o build
            - name: ğŸ”¨ Build Static Site
              run: node builder.js

            # 5. Verificar se dist/ foi criado
            - name: âœ… Verify Build Output
              run: |
                  if [ ! -d "dist" ]; then
                    echo "âŒ Error: dist/ directory not found!"
                    exit 1
                  fi
                  echo "âœ“ Build successful - dist/ directory exists"
                  ls -la dist/

            # 6. Deploy para FTP
            - name: ğŸš€ Deploy to FTP Server
              uses: SamKirkland/FTP-Deploy-Action@v4.3.5
              with:
                  server: ${{ secrets.FTP_SERVER }}
                  username: ${{ secrets.FTP_USERNAME }}
                  password: ${{ secrets.FTP_PASSWORD }}
                  local-dir: ./dist/
                  server-dir: ./public_html/
                  dangerous-clean-slate: false
                  exclude: |
                      **/.git*
                      **/.git*/**
                      **/node_modules/**
                      **/.DS_Store

            # 7. NotificaÃ§Ã£o de sucesso
            - name: ğŸ‰ Deployment Complete
              run: |
                  echo "================================================"
                  echo "âœ¨ Deployment completed successfully!"
                  echo "================================================"
                  echo "ğŸŒ Your landing page is now live!"
                  echo "================================================"
